import{useRef as n,useState as e,useEffect as r,useCallback as o}from"react";import{Scribe as t,RealtimeEvents as l,Conversation as i}from"@elevenlabs/client";export{AudioFormat,CommitStrategy,RealtimeEvents,postOverallFeedback}from"@elevenlabs/client";function u(){return u=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)({}).hasOwnProperty.call(r,o)&&(n[o]=r[o])}return n},u.apply(null,arguments)}function a(i={}){const{onSessionStarted:a,onPartialTranscript:s,onCommittedTranscript:c,onCommittedTranscriptWithTimestamps:d,onError:v,onAuthError:m,onQuotaExceededError:g,onCommitThrottledError:p,onTranscriberError:T,onUnacceptedTermsError:C,onRateLimitedError:h,onInputError:E,onQueueOverflowError:S,onResourceExhaustedError:M,onSessionTimeLimitExceededError:I,onChunkSizeExceededError:D,onInsufficientAudioActivityError:R,onConnect:b,onDisconnect:w,token:y,modelId:A,baseUri:f,commitStrategy:O,vadSilenceThresholdSecs:U,vadThreshold:k,minSpeechDurationMs:F,minSilenceDurationMs:_,languageCode:P,microphone:x,audioFormat:N,sampleRate:V,autoConnect:L=!1,includeTimestamps:q}=i,B=n(null),[H,$]=e("disconnected"),[Q,W]=e(""),[X,j]=e([]),[z,K]=e(null);r(()=>()=>{var n;null==(n=B.current)||n.close()},[]);const Y=o(async(n={})=>{if(B.current)console.warn("Already connected");else try{var e,r;$("connecting"),K(null);const o=n.token||y,i=n.modelId||A;if(!o)throw new Error("Token is required");if(!i)throw new Error("Model ID is required");const u=n.microphone||x,L=n.audioFormat||N,H=n.sampleRate||V;let Q;const X=null!=(e=null!=(r=n.includeTimestamps)?r:q)?e:!(!n.onCommittedTranscriptWithTimestamps&&!d);if(u)Q=t.connect({token:o,modelId:i,baseUri:n.baseUri||f,commitStrategy:n.commitStrategy||O,vadSilenceThresholdSecs:n.vadSilenceThresholdSecs||U,vadThreshold:n.vadThreshold||k,minSpeechDurationMs:n.minSpeechDurationMs||F,minSilenceDurationMs:n.minSilenceDurationMs||_,languageCode:n.languageCode||P,microphone:u,includeTimestamps:X});else{if(!L||!H)throw new Error("Either microphone options or (audioFormat + sampleRate) must be provided");Q=t.connect({token:o,modelId:i,baseUri:n.baseUri||f,commitStrategy:n.commitStrategy||O,vadSilenceThresholdSecs:n.vadSilenceThresholdSecs||U,vadThreshold:n.vadThreshold||k,minSpeechDurationMs:n.minSpeechDurationMs||F,minSilenceDurationMs:n.minSilenceDurationMs||_,languageCode:n.languageCode||P,includeTimestamps:X,audioFormat:L,sampleRate:H})}B.current=Q,Q.on(l.SESSION_STARTED,()=>{$("connected"),null==a||a()}),Q.on(l.PARTIAL_TRANSCRIPT,n=>{const e=n;W(e.text),$("transcribing"),null==s||s(e)}),Q.on(l.COMMITTED_TRANSCRIPT,n=>{const e=n,r={id:`${Date.now()}-${Math.random()}`,text:e.text,timestamp:Date.now(),isFinal:!0};j(n=>[...n,r]),W(""),null==c||c(e)}),Q.on(l.COMMITTED_TRANSCRIPT_WITH_TIMESTAMPS,n=>{const e=n,r={id:`${Date.now()}-${Math.random()}`,text:e.text,timestamp:Date.now(),isFinal:!0,words:e.words};j(n=>[...n,r]),W(""),null==d||d(e)}),Q.on(l.ERROR,n=>{const e=n;K(e.error),$("error"),null==v||v(new Error(e.error))}),Q.on(l.AUTH_ERROR,n=>{const e=n;K(e.error),$("error"),null==m||m(e)}),Q.on(l.QUOTA_EXCEEDED,n=>{const e=n;K(e.error),$("error"),null==g||g(e)}),Q.on(l.COMMIT_THROTTLED,n=>{const e=n;K(e.error),$("error"),null==p||p(e)}),Q.on(l.TRANSCRIBER_ERROR,n=>{const e=n;K(e.error),$("error"),null==T||T(e)}),Q.on(l.UNACCEPTED_TERMS,n=>{const e=n;K(e.error),$("error"),null==C||C(e)}),Q.on(l.RATE_LIMITED,n=>{const e=n;K(e.error),$("error"),null==h||h(e)}),Q.on(l.INPUT_ERROR,n=>{const e=n;K(e.error),$("error"),null==E||E(e)}),Q.on(l.QUEUE_OVERFLOW,n=>{const e=n;K(e.error),$("error"),null==S||S(e)}),Q.on(l.RESOURCE_EXHAUSTED,n=>{const e=n;K(e.error),$("error"),null==M||M(e)}),Q.on(l.SESSION_TIME_LIMIT_EXCEEDED,n=>{const e=n;K(e.error),$("error"),null==I||I(e)}),Q.on(l.CHUNK_SIZE_EXCEEDED,n=>{const e=n;K(e.error),$("error"),null==D||D(e)}),Q.on(l.INSUFFICIENT_AUDIO_ACTIVITY,n=>{const e=n;K(e.error),$("error"),null==R||R(e)}),Q.on(l.OPEN,()=>{null==b||b()}),Q.on(l.CLOSE,()=>{$("disconnected"),B.current=null,null==w||w()})}catch(n){const e=n instanceof Error?n.message:"Failed to connect";throw K(e),$("error"),n}},[y,A,f,O,U,k,F,_,P,x,N,V,q,a,s,c,d,v,m,g,p,T,C,h,E,S,M,I,D,R,b,w]),Z=o(()=>{var n;null==(n=B.current)||n.close(),B.current=null,$("disconnected")},[]),G=o((n,e)=>{if(!B.current)throw new Error("Not connected to Scribe");B.current.send(u({audioBase64:n},e))},[]),J=o(()=>{if(!B.current)throw new Error("Not connected to Scribe");B.current.commit()},[]),nn=o(()=>{j([]),W("")},[]),en=o(()=>B.current,[]);return r(()=>{L&&Y()},[L,Y]),{status:H,isConnected:"connected"===H||"transcribing"===H,isTranscribing:"transcribing"===H,partialTranscript:Q,committedTranscripts:X,error:z,connect:Y,disconnect:Z,sendAudio:G,commit:J,clearTranscripts:nn,getConnection:en}}const s=["micMuted","volume","serverLocation"];function c(n="us"){switch(n){case"eu-residency":case"in-residency":case"us":case"global":return n;default:return console.warn(`[ConversationalAI] Invalid server-location: ${n}. Defaulting to "us"`),"us"}}function d(n){return{us:"wss://api.elevenlabs.io","eu-residency":"wss://api.eu.residency.elevenlabs.io","in-residency":"wss://api.in.residency.elevenlabs.io",global:"wss://api.elevenlabs.io"}[n]}function v(n){return{us:"wss://livekit.rtc.elevenlabs.io","eu-residency":"wss://livekit.rtc.eu.residency.elevenlabs.io","in-residency":"wss://livekit.rtc.in.residency.elevenlabs.io",global:"wss://livekit.rtc.elevenlabs.io"}[n]}function m(o={}){const{micMuted:t,volume:l,serverLocation:a}=o,m=function(n,e){if(null==n)return{};var r={};for(var o in n)if({}.hasOwnProperty.call(n,o)){if(-1!==e.indexOf(o))continue;r[o]=n[o]}return r}(o,s),g=n(null),p=n(null),[T,C]=e("disconnected"),[h,E]=e(!1),[S,M]=e("listening"),I=n(t),D=n(l);return I.current=t,D.current=l,r(()=>{var n;void 0!==t&&(null==g||null==(n=g.current)||n.setMicMuted(t))},[t]),r(()=>{var n;void 0!==l&&(null==g||null==(n=g.current)||n.setVolume({volume:l}))},[l]),r(()=>()=>{var n;null==(n=g.current)||n.endSession()},[]),{startSession:async n=>{var e;if(null!=(e=g.current)&&e.isOpen())return g.current.getId();if(p.current)return(await p.current).getId();try{var r,o,t,l,s,T,h,S,R,b;const e=c((null==n?void 0:n.serverLocation)||a),w=d(e),y=v(e);return p.current=i.startSession(u({},null!=m?m:{},null!=n?n:{},{origin:w,livekitUrl:(null==n?void 0:n.livekitUrl)||(null==m?void 0:m.livekitUrl)||y,overrides:u({},null!=(r=null==m?void 0:m.overrides)?r:{},null!=(o=null==n?void 0:n.overrides)?o:{},{client:u({},null!=(t=null==m||null==(l=m.overrides)?void 0:l.client)?t:{},null!=(s=null==n||null==(T=n.overrides)?void 0:T.client)?s:{},{source:(null==n||null==(h=n.overrides)||null==(h=h.client)?void 0:h.source)||(null==m||null==(S=m.overrides)||null==(S=S.client)?void 0:S.source)||"react_sdk",version:(null==n||null==(R=n.overrides)||null==(R=R.client)?void 0:R.version)||(null==m||null==(b=m.overrides)||null==(b=b.client)?void 0:b.version)||"0.12.1"})}),onConnect:(null==n?void 0:n.onConnect)||(null==m?void 0:m.onConnect),onDisconnect:(null==n?void 0:n.onDisconnect)||(null==m?void 0:m.onDisconnect),onError:(null==n?void 0:n.onError)||(null==m?void 0:m.onError),onMessage:(null==n?void 0:n.onMessage)||(null==m?void 0:m.onMessage),onAudio:(null==n?void 0:n.onAudio)||(null==m?void 0:m.onAudio),onDebug:(null==n?void 0:n.onDebug)||(null==m?void 0:m.onDebug),onUnhandledClientToolCall:(null==n?void 0:n.onUnhandledClientToolCall)||(null==m?void 0:m.onUnhandledClientToolCall),onVadScore:(null==n?void 0:n.onVadScore)||(null==m?void 0:m.onVadScore),onInterruption:(null==n?void 0:n.onInterruption)||(null==m?void 0:m.onInterruption),onAgentToolRequest:(null==n?void 0:n.onAgentToolRequest)||(null==m?void 0:m.onAgentToolRequest),onAgentToolResponse:(null==n?void 0:n.onAgentToolResponse)||(null==m?void 0:m.onAgentToolResponse),onConversationMetadata:(null==n?void 0:n.onConversationMetadata)||(null==m?void 0:m.onConversationMetadata),onMCPToolCall:(null==n?void 0:n.onMCPToolCall)||(null==m?void 0:m.onMCPToolCall),onMCPConnectionStatus:(null==n?void 0:n.onMCPConnectionStatus)||(null==m?void 0:m.onMCPConnectionStatus),onAsrInitiationMetadata:(null==n?void 0:n.onAsrInitiationMetadata)||(null==m?void 0:m.onAsrInitiationMetadata),onAgentChatResponsePart:(null==n?void 0:n.onAgentChatResponsePart)||(null==m?void 0:m.onAgentChatResponsePart),onModeChange:({mode:e})=>{var r;M(e),null==(r=(null==n?void 0:n.onModeChange)||(null==m?void 0:m.onModeChange))||r({mode:e})},onStatusChange:({status:e})=>{var r;C(e),null==(r=(null==n?void 0:n.onStatusChange)||(null==m?void 0:m.onStatusChange))||r({status:e})},onCanSendFeedbackChange:({canSendFeedback:e})=>{var r;E(e),null==(r=(null==n?void 0:n.onCanSendFeedbackChange)||(null==m?void 0:m.onCanSendFeedbackChange))||r({canSendFeedback:e})}})),g.current=await p.current,void 0!==I.current&&g.current.setMicMuted(I.current),void 0!==D.current&&g.current.setVolume({volume:D.current}),g.current.getId()}finally{p.current=null}},endSession:async()=>{const n=g.current;g.current=null,await(null==n?void 0:n.endSession())},setVolume:({volume:n})=>{var e;null==(e=g.current)||e.setVolume({volume:n})},getInputByteFrequencyData:()=>{var n;return null==(n=g.current)?void 0:n.getInputByteFrequencyData()},getOutputByteFrequencyData:()=>{var n;return null==(n=g.current)?void 0:n.getOutputByteFrequencyData()},getInputVolume:()=>{var n,e;return null!=(n=null==(e=g.current)?void 0:e.getInputVolume())?n:0},getOutputVolume:()=>{var n,e;return null!=(n=null==(e=g.current)?void 0:e.getOutputVolume())?n:0},sendFeedback:n=>{var e;null==(e=g.current)||e.sendFeedback(n)},getId:()=>{var n;return null==(n=g.current)?void 0:n.getId()},sendContextualUpdate:n=>{var e;null==(e=g.current)||e.sendContextualUpdate(n)},sendUserMessage:n=>{var e;null==(e=g.current)||e.sendUserMessage(n)},sendUserActivity:()=>{var n;null==(n=g.current)||n.sendUserActivity()},sendMCPToolApprovalResult:(n,e)=>{var r;null==(r=g.current)||r.sendMCPToolApprovalResult(n,e)},changeInputDevice:async n=>{if(g.current&&"changeInputDevice"in g.current)return await g.current.changeInputDevice(n);throw new Error("Device switching is only available for voice conversations")},changeOutputDevice:async n=>{if(g.current&&"changeOutputDevice"in g.current)return await g.current.changeOutputDevice(n);throw new Error("Device switching is only available for voice conversations")},status:T,canSendFeedback:h,micMuted:t,isSpeaking:"speaking"===S}}export{v as getLivekitUrlForLocation,d as getOriginForLocation,c as parseLocation,m as useConversation,a as useScribe};
//# sourceMappingURL=lib.modern.js.map
